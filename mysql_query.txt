CREATE DATABASE tori;

USE tori;

CREATE TABLE activity ( id int unsigned not null auto_increment,
                        tori_id int not null,
                        time timestamp,
                        activity_type varchar(20),
                        description varchar(100),
                        PRIMARY KEY (id) );

CREATE TABLE arrangement ( tori_id int not null,
                           locations varchar(200),
                           PRIMARY KEY (tori_id) );

CREATE TABLE hearts ( tori_id int not null,
                      hearts FLOAT,
                      PRIMARY KEY (tori_id) );

CREATE trigger activity_log BEFORE INSERT ON activity
  FOR EACH ROW
    BEGIN
     IF (SELECT count(time) FROM activity WHERE tori_id = NEW.tori_id) > 10
     THEN
       DELETE FROM activity WHERE id = (
        SELECT id FROM activity WHERE tori_id = NEW.tori_id ORDER BY time ASC LIMIT 1
       );
     END IF;
    END
